## LivenessProbe
используется для проверки, когда перезапустить контейнер. Например, liveness проба должна поймать блокировку, когда приложение запущено, но не может ничего сделать. В этом случае перезапуск приложения может помочь сделать приложение более доступным, несмотря на баги.

3 типа проверок:
- httpGet
- TCP
- exec

Поднимем
<details> <summary>kuber-deploy.yaml</summary>

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kuber-default
  labels:
    app: kuber
spec:
  replicas: 1
  selector:
    matchLabels:
      app: http-server-default
  template:
    metadata:
      labels:
        app: http-server-default
    spec:
      containers:
      - name: kuber-app
        image: bakavets/kuber:v1.0
        ports:
        - containerPort: 8000
---
apiVersion: v1
kind: Service
metadata:
  name: kuber-default-service
spec:
  selector:
    app: http-server-default
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8000
      nodePort: 30001
```
</details>

### Exec-LivenessProbe

<details> <summary>kuber-deploy-livenessProbe-exec.yaml</summary>

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ubuntu
  labels:
    app: ubuntu
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ubuntu
  template:
    metadata:
      labels:
        app: ubuntu
    spec:
      containers:
      - name: ubuntu
        image: ubuntu
        args:
        - /bin/sh
        - -c
        - touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 600     # создаёт файл, спит 30 сек и удаляет,спит 10 мин
        livenessProbe:
          exec:                       # указание типа проверки
            command:
            - cat                     # проверка командой cat...
            - /tmp/healthy            # ...существует ли этот файл
          initialDelaySeconds: 5      # Количество секунд от старта контейнера до пробы. По дефолту 0 секунд. Минимум 0.
          periodSeconds: 5            # Длительность времени между двумя последовательными проведениям проб. По дефолту до 10 секунд. Минимум 1.
          timeoutSeconds: 1           # Кол-во секунд ожидания пробы(если что-то идёт не так - она падает по таймауту и считается failure) По дефолту 1 секунда. Минимум 1.
          successThreshold: 1         # Миннимальное кол-во последовательных проверок чтобы проба считалась успешной после неудачной. По дефолту до 1. Должно быть 1 для liveness and startup Probes. Минимум 1.
          failureThreshold: 3         # После задонного колва(3) контейнер считается умершим. Дефолт до 3. Минимум 1.
```
</details>

через 30 секунд файл healthy помер и проба перезапустила контейнер

![image](https://github.com/user-attachments/assets/8aaa9608-2bde-47d6-b6f4-0a7bc9bfe5ce)

и так до бесконечности

![image](https://github.com/user-attachments/assets/0f28d900-3268-4d3b-99d2-b98e1687359c)

### TCP-LivenessProbe

<details> <summary>kuber-deploy-livenessProbe-tcp.yaml</summary>

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kuber-tcp
  labels:
    app: kuber
spec:
  replicas: 1
  selector:
    matchLabels:
      app: http-server-tcp
  template:
    metadata:
      labels:
        app: http-server-tcp
    spec:
      containers:
      - name: kuber-app
        image: bakavets/kuber:v1.0
        ports:
        - containerPort: 8000
        livenessProbe:
          tcpSocket:                # указание типа проверки
            port: 8000
          initialDelaySeconds: 15   # Дефолт 0. Минимум 0
          periodSeconds: 10         # Дефолт до 10. Минимум 1
          timeoutSeconds: 1         # Дефолт до 1. Минимум 1
          successThreshold: 1       # Дефолт до 1. Должно быть 1 для liveness and startup Probes. Минимум 1
          failureThreshold: 3       # Дефолт до 3. Минимум 1
---
apiVersion: v1
kind: Service
metadata:
  name: kuber-service-tcp
spec:
  selector:
    app: http-server-tcp
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8000
      nodePort: 30002
  type: NodePort
```
</details>
