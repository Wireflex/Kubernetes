# CronJobs
позволяет запускать Job из темплейта, опреденным манифестом по определенному графику с определенной периодичностью, график определяется в cron-формате

![image](https://github.com/user-attachments/assets/9f5a7c57-21ec-48d4-aa37-7dfb78a4e99b)

создать расписание можно [тут](https://crontab.guru/)

<details> <summary>0-cronjob.yaml</summary>

``` 
apiVersion: batch/v1
kind: CronJob
metadata:
  name: hello
spec:
  schedule: "*/1 * * * *"         # каждую минуту будет создаваться Job
  jobTemplate:
    spec:
      backoffLimit: 4             # кол-во повторных попыток, прежде чем Job будет считаться неудачным ( по умолчанию 6 )
      activeDeadlineSeconds: 240  # спустя 240 сек Job закончится, без разницы в каком состоянии будут ПОДЫ, имеет приоритет над backoffLimit
      parallelism: 2              # 2 ПОДА будут запускаться параллельно(2 Job)
      completions: 3              # количество завершенных (successful) Job'ов, которые должны быть запущены для завершения CronJob'а
      template:
        spec:
          containers:
          - name: hello
            image: busybox
            imagePullPolicy: IfNotPresent
            command:
            - /bin/sh
            - -c
            - date; echo Hello from the Kubernetes cluster
          restartPolicy: OnFailure

```
</details>

:point_down: concurrencyPolicy позволяет запускать несколько Job подряд, то есть в файле расписание каждую минуту, но Job будет выполняться 140 секунд(sleep 140), однако спустя 60 секу запустится новая, не дожидаясь окончания первой

<details> <summary>1-cronjob-allow.yaml</summary>

``` 
apiVersion: batch/v1
kind: CronJob
metadata:
  name: hello-allow
spec:
  schedule: "*/1 * * * *"
  concurrencyPolicy: Allow
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: hello
            image: busybox
            args:
            - /bin/sh
            - -c
            - date; echo "Hello World!"; sleep 140
          restartPolicy: OnFailure
```
</details>

![image](https://github.com/user-attachments/assets/87c3614f-324a-4583-aa05-a8f8b53c7317)

если значение concurrencyPolicy изменить на Forbid, то не позволит запуститься следующей Job, до завершения первой

если значение concurrencyPolicy изменить на Replace, то когда придёт время запускать 2ую Job, CronJobController удалит старую и запустит новую,без разницы на время выполнения(140 сек)

