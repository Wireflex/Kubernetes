# ConfigMap 
используется для хранения НЕсекретных данных в парах ключ-значение, ПОДЫ юзают ConfigMap как переменные окружения, аргументы командной строки или как файлы конфигурации в Volume. 

Допустим, у вас есть веб-приложение, которое требует различные параметры конфигурации, такие как URL-адрес базы данных, порты и флаги включения/выключения функций. Вместо того чтобы жестко кодировать эти параметры в вашем приложении или образе контейнера, вы можете использовать ConfigMap для их хранения.

Это позволяет,к примеру, использовать 1 docker-image, который работает локально и в облаке, то есть для приложения локально и remote приложения нет необходимости пересобирать image для каждого из них, т.к этот параметр динамический ( local и remote )

Конфиги для разных окружений нужны разные, и опять же, чтоб не собирать отдельный docker-image для каждого конфига, можно монтировать конфиг внутрь докера при запуске ПОДА

Для больших файлов юзают Volume, для небольших - ConfigMap

<details> <summary>example1.yml</summary>

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kuber-1
  labels:
    app: kuber-1
spec:
  replicas: 1
  selector:
    matchLabels:
      app: http-server-1
  template:
    metadata:
      labels:
        app: http-server-1
    spec:
      containers:
      - name: kuber-app
        image: bakavets/kuber:v1.0
        ports:
        - containerPort: 8000
        env:                      # переменные окружения
        - name: HELLO             # имя (ключ)
          value: "Hello"          # значение
        - name: WORLD
          value: "World"
        - name: ENV_HELLO_WORLD
          value: "$(HELLO)_$(WORLD) from Pod"  # комбинация переменныхх окружения
```
</details>

![image](https://github.com/user-attachments/assets/f02a158c-5337-42a9-9696-34cf2ab5495e)

По аналогии с [CMD/ENTRYPOINT](https://github.com/Wireflex/Kubernetes/blob/de0f35bcbb307c3b629b3e40a46396faae01d9d9/10.CMD%26ENTRYPOINTinKuber.md)
<details> <summary>example2.yml</summary>

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kuber-args
  labels:
    app: kuber
spec:
  replicas: 1
  selector:
    matchLabels:
      app: http-server-args
  template:
    metadata:
      labels:
        app: http-server-args
    spec:
      containers:
      - name: kuber-app
        image: bakavets/kuber:v1.0-args
        args: ["$(INTERVAL)","$(COUNT)","$(TEXT_ARG)"]
        ports:
        - containerPort: 8000
        env:
        - name: INTERVAL
          value: "3"
        - name: COUNT
          value: "4"
        - name: TEXT_ARG
          value: "Interval = $(INTERVAL). Desired count of print = $(COUNT)."
```
</details>

ну и наконец 

<details> <summary>configmap.yaml</summary>

```
apiVersion: v1
kind: ConfigMap
metadata:
  name: demo-cm
data:
  # property-like keys; each key maps to a simple value
  interval: "5"
  count: "3"
  # file-like keys
  properties: |           # мультилайн
    Hello from World!
    This is demo config!
    As an example.
  config.ini: "This is demo config!"  # произвольное значение 
```
</details>

<details> <summary>deploy.yaml</summary>

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kuber-2
  labels:
    app: kuber-2
spec:
  replicas: 1
  selector:
    matchLabels:
      app: http-server-2
  template:
    metadata:
      labels:
        app: http-server-2
    spec:
      containers:
      - name: kuber-app
        image: bakavets/kuber:v1.0-args
        args: ["$(INTERVAL)","$(COUNT)","$(TEXT_ARG)"]
        ports:
        - containerPort: 8000
        env:                    # здесь переменные окружения 
          - name: INTERVAL      # будем брать 
            valueFrom:
              configMapKeyRef:  # из configmap.yaml
                name: demo-cm   # имя, понятное дело, должно совпадать с именем configmap.yaml
                key: interval
          - name: COUNT
            valueFrom:
              configMapKeyRef:
                name: demo-cm
                key: count
          - name: TEXT_ARG
            valueFrom:
              configMapKeyRef:
                name: demo-cm
                key: properties
        volumeMounts:             # пробрасываем volume внутрь ПОДА
        - name: config            # должно совпадать с volumes
          mountPath: "/config"    # в эту директорию (создастся, если её нет)
          readOnly: true
      volumes:   
        # You set volumes at the Pod level, then mount them into containers inside that Pod
        - name: config          # должно совпадать с volumeMounts
          configMap:            # тип вольюма
            # Provide the name of the ConfigMap you want to mount.
            name: demo-cm       # имя сonfigmap.yaml
            # An array of keys from the ConfigMap to create as files
            items:                # указываем какие именно файлы хотим вмонтировать внутрь /config
            - key: "properties"   # 2 последних...
              path: "properties"  # ...значения...
            - key: "config.ini"   # ...из файла...
              path: "config.ini"  # ...configmap.yaml
```
</details>
